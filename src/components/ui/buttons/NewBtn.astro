---
const { href, text = 'NEW' } = Astro.props
---

<a href={href} class="btn-wrapper" target="_blank">
  <div class="btn">
    <strong>{text}</strong>

    <!-- NEW Badge -->
    <span class="badge"> {text} </span>

    <div id="container-stars">
      <canvas id="stars-canvas"></canvas>
    </div>
    <div id="glow">
      <div class="circle"></div>
      <div class="circle"></div>
    </div>
  </div>
</a>

<style>
  .btn-wrapper {
    position: relative;
    width: 100%;
  }

  .btn {
    position: relative;
    display: flex;
    justify-content: center;
    align-items: center;
    width: 100%;
    height: 3rem;
    background-color: transparent;
    cursor: pointer;
    backdrop-filter: blur(1rem);
    transition:
      background-color 0.5s,
      transform 0.2s ease-in-out;
    border: none;
    border-radius: 5px;
    overflow: hidden;
  }

  strong {
    z-index: 2;
    font-family: 'Avalors Personal Use', sans-serif;
    font-size: 16px;
    letter-spacing: 5px;
    text-shadow: 0 0 8px #1a1a1a;
    user-select: none;
  }

  html.dark strong {
    text-shadow: 0 0 8px #ffffff;
  }

  .badge {
    position: absolute;
    top: -0.25rem;
    right: -0.25rem;
    z-index: 10;
    display: flex;
    height: 1.25rem;
    align-items: center;
    justify-content: center;
    border-radius: 9999px;
    background-color: #1a1a1a;
    padding: 0 0.5rem;
    font-size: 10px;
    font-weight: 700;
    color: #ffffff;
    transition:
      background-color 0.3s,
      color 0.3s;
  }

  html.dark .badge {
    background-color: #e5e5e5;
    color: #000000;
  }

  #container-stars {
    position: absolute;
    z-index: -1;
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: 5px;
    transition: background-color 0.5s;
  }

  #stars-canvas {
    width: 100%;
    height: 100%;
    display: block;
  }

  #glow {
    position: absolute;
    display: flex;
    width: 12rem;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
  }

  .circle {
    width: 100%;
    height: 30px;
    filter: blur(2rem);
    z-index: -1;
  }

  .circle:nth-of-type(1) {
    background: rgba(13, 255, 159, 0.636);
  }

  .circle:nth-of-type(2) {
    background: rgba(0, 255, 200, 0.704);
  }

  .btn:hover #container-stars {
    z-index: 1;
    background-color: #f7f7f7;
  }

  html.dark .btn:hover #container-stars {
    background-color: rgb(3, 3, 3);
  }

  .btn:hover #glow {
    opacity: 1;
  }

  .btn:active {
    transform: scale(0.98);
  }

  .btn:active .circle {
    background: #0dff9f;
  }

  .btn-wrapper::before {
    content: '';
    position: absolute;
    inset: -2px;
    background: linear-gradient(
      45deg,
      #ff003700,
      #0dff9f1e,
      #00ffc846,
      #0dff9f46,
      #00ffc81e,
      #ff003700
    );
    border-radius: 5px;
    opacity: 0;
    filter: blur(5px);
    animation: glowPulse 4s ease-in-out infinite;
    z-index: -1;
  }

  @keyframes glowPulse {
    0%,
    100% {
      opacity: 0;
      transform: scale(0.98);
    }
    50% {
      opacity: 0.4;
      transform: scale(1.02);
    }
  }

  .btn-wrapper:hover::before {
    animation: none;
    opacity: 1;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const baseCanvas = document.querySelector('#stars-canvas')
    const canvas = baseCanvas instanceof HTMLCanvasElement ? baseCanvas : null
    const ctx = canvas ? canvas.getContext('2d') : null
    const btnContainer = document.querySelector('#container-stars')

    /**
     * Particle type definition
     */
    interface Particle {
      x: number
      y: number
      size: number
      speedX: number
      speedY: number
      opacity: number
      color: string
      life: number
      maxLife: number
    }

    /** @type {Particle[]} */
    let particles: Particle[] = []
    let currentTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light'

    function canvasWidth() {
      return canvas instanceof HTMLCanvasElement ? canvas.width : 0
    }

    function canvasHeight() {
      return canvas instanceof HTMLCanvasElement ? canvas.height : 0
    }
    const numParticles = 40

    // adjust canvas resolution to container size (high-DPI aware)
    function resizeCanvas() {
      if (!canvas || !btnContainer || !ctx) return
      const dpr = window.devicePixelRatio || 1
      if (canvas instanceof HTMLCanvasElement && btnContainer instanceof HTMLElement) {
        canvas.style.width = `${btnContainer.offsetWidth}px`
        canvas.style.height = `${btnContainer.offsetHeight}px`
        canvas.width = btnContainer.offsetWidth * dpr
        canvas.height = btnContainer.offsetHeight * dpr
      }
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0)
    }

    // create a random particle
    function createParticle() {
      const baseColor = currentTheme === 'dark' ? '255, 255, 255' : '26, 26, 26'
      return {
        x: Math.random() * canvasWidth(),
        y: Math.random() * canvasHeight(),
        size: Math.random() * 0.8 + 0.4,
        speedX: (Math.random() - 0.5) * 0.08,
        speedY: (Math.random() - 0.5) * 0.08,
        opacity: Math.random() * 0.6 + 0.2,
        color: `rgba(${baseColor}, ${Math.random() * 0.8 + 0.2})`,
        life: 0,
        maxLife: Math.random() * 200 + 80,
      }
    }

    // handle theme changes
    function handleThemeChange() {
      const newTheme = document.documentElement.classList.contains('dark') ? 'dark' : 'light'
      if (newTheme !== currentTheme) {
        currentTheme = newTheme
        initParticles() // regenerate all particles with new colors
      }
    }

    // initialize particles
    function initParticles() {
      particles = []
      for (let i = 0; i < numParticles; i++) {
        particles.push(createParticle())
      }
    }

    // draw particles
    function drawParticles() {
      if (!ctx || !canvas) return
      ctx.clearRect(0, 0, canvasWidth(), canvasHeight())
      particles.forEach((p) => {
        ctx.beginPath()
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2)
        ctx.fillStyle = p.color
        ctx.fill()
      })
    }

    // update particle positions and lifecycle
    function updateParticles() {
      for (let i = 0; i < particles.length; i++) {
        let p = particles[i]

        p.x += p.speedX
        p.y += p.speedY
        p.life++

        // regenerate particle if out of bounds or life expired
        if (
          p.x < 0 ||
          p.x > canvasWidth() ||
          p.y < 0 ||
          p.y > canvasHeight() ||
          p.life >= p.maxLife
        ) {
          particles[i] = createParticle()
        }
      }
    }

    // animation loop
    function animate() {
      updateParticles()
      drawParticles()
      requestAnimationFrame(animate)
    }

    // Event Listeners
    window.addEventListener('resize', resizeCanvas)

    // Listen for theme changes
    const observer = new MutationObserver(handleThemeChange)
    observer.observe(document.documentElement, {
      attributes: true,
      attributeFilter: ['class'],
    })

    if (!ctx || !canvas || !btnContainer) return
    resizeCanvas()
    initParticles()
    animate()
  })
</script>
