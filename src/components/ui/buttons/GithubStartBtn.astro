---
import { GitHubIcon } from '@/components/icons/icons'

interface Props {
  href?: string
  repo?: string
}

const { href = 'https://github.com/gohitx/gohit.xyz', repo = 'gohitx/gohit.xyz' } = Astro.props
---

<a
  href={href}
  target="_blank"
  rel="noopener noreferrer"
  class="inline-flex items-center gap-1.5 rounded-md bg-[#5e5e5e48] px-2 py-1 text-inherit no-underline transition-opacity duration-200 hover:opacity-80"
  aria-label="GitHub repository"
>
  <div class="h-5 w-5 text-current">
    <GitHubIcon className="h-5 w-5" />
  </div>
  <span class="stars-count text-[13px] font-medium" data-repo={repo}>0</span>
</a>

<script>
  async function fetchGitHubStars() {
    const starsElements = document.querySelectorAll('.stars-count')

    starsElements.forEach(async (element) => {
      const repo = element.getAttribute('data-repo')
      if (!repo) return

      try {
        const response = await fetch(`https://api.github.com/repos/${repo}`)
        if (!response.ok) throw new Error('Network response was not ok')
        const data = await response.json()
        const stars = data.stargazers_count || 0
        element.textContent = new Intl.NumberFormat('en-US', {
          notation: 'compact',
          maximumFractionDigits: 1,
        }).format(stars)
      } catch (error) {
        // Only log errors in development
        if (import.meta.env.DEV) {
          console.error(`Error fetching GitHub stars for ${repo}:`, error)
        }
        element.textContent = '0'
      }
    })
  }

  fetchGitHubStars()
</script>
